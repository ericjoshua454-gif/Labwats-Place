<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Dashboard | Labwatâ€™s Place</title>

  <!-- Responsive Stylesheets -->
  <link rel="stylesheet" href="desktop.css" media="screen and (min-width: 1025px)">
  <link rel="stylesheet" href="tablet.css" media="screen and (min-width: 768px) and (max-width: 1024px)">
  <link rel="stylesheet" href="mobile.css" media="screen and (max-width: 767px)">
</head>
<body>
  <!-- HEADER -->
  <header class="main-header">
    <h2 class="logo">Labwatâ€™s Place</h2>
    <nav class="navbar">
      <a href="index.html">Home</a>
      <a href="#" id="logoutBtn">Logout</a>
    </nav>
  </header>

  <!-- DASHBOARD MAIN -->
  <main class="user-dashboard container">
    <h1>Welcome, <span id="userName">Customer</span> ðŸ‘‹</h1>

    <!-- SUMMARY CARDS -->
    <section class="summary-cards">
      <div class="card">
        <h3>Total Orders</h3>
        <p id="userTotalOrders">0</p>
      </div>
      <div class="card">
        <h3>Delivered</h3>
        <p id="userDelivered">0</p>
      </div>
      <div class="card">
        <h3>Pending</h3>
        <p id="userPending">0</p>
      </div>
    </section>

    <!-- USER ORDER HISTORY -->
    <section class="orders-section">
      <h2>My Orders</h2>
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Item</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="userOrdersBody">
          <!-- Orders will be loaded here -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>Â© 2025 Labwatâ€™s Place. All rights reserved.</p>
  </footer>

  <!-- SHARED SCRIPT -->
  <script src="main.js"></script>
  <script src="mobile-features.js"></script>
  <script src="tablet-features.js"></script>
  <script src="desktop-features.js"></script>
  <script src="script.js"></script>

  <!-- Supabase Library + Initialization -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://bqwsozssaxegxsdfalnd.supabase.co";
    const SUPABASE_KEY = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxd3NvenNzYXhlZ3hzZGZhbG5kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzNjE1MzcsImV4cCI6MjA3NTkzNzUzN30._FZbzpsmEDtE7cUT7bWWA21404zVLDy2XM9WjZyLcWE";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>

  <!-- DASHBOARD SCRIPT -->
  <script>
    async function loadDashboard() {
      // Check logged-in user
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      document.getElementById('userName').textContent = user.user_metadata.full_name || "Customer";

      // Fetch orders from Supabase (replace with your table name)
      const { data: orders, error } = await supabase
        .from('orders')
        .select('*')
        .eq('user_id', user.id);

      if (error) {
        console.error("Error fetching orders:", error);
        return;
      }

      // Update summary cards
      const totalOrders = orders.length;
      const delivered = orders.filter(o => o.status === 'Delivered').length;
      const pending = orders.filter(o => o.status === 'Pending').length;

      document.getElementById('userTotalOrders').textContent = totalOrders;
      document.getElementById('userDelivered').textContent = delivered;
      document.getElementById('userPending').textContent = pending;

      // Display orders in table
      const tableBody = document.getElementById('userOrdersBody');
      tableBody.innerHTML = ''; // clear previous rows
      orders.forEach(order => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${order.item}</td>
          <td>$${order.amount}</td>
          <td><span class="status ${order.status.toLowerCase()}">${order.status}</span></td>
          <td>${order.date}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    loadDashboard();
  </script>
</body>
</html>
