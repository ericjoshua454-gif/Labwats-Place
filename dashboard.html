<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Dashboard | Labwat‚Äôs Place</title>

  <!-- Responsive Stylesheets -->
  <link rel="stylesheet" href="desktop.css" media="screen and (min-width: 1025px)" />
  <link rel="stylesheet" href="tablet.css" media="screen and (min-width: 768px) and (max-width: 1024px)" />
  <link rel="stylesheet" href="mobile.css" media="screen and (max-width: 767px)" />
</head>
<body>
  <!-- HEADER -->
  <header class="main-header">
    <h2 class="logo">Labwat‚Äôs Place</h2>
    <nav class="navbar">
      <a href="index.html">Home</a>
      <a href="#" id="logoutBtn">Logout</a>
    </nav>
  </header>

  <!-- DASHBOARD MAIN -->
  <main class="user-dashboard container">
    <h1>Welcome, <span id="userName">Customer</span> üëã</h1>

    <!-- SUMMARY CARDS -->
    <section class="summary-cards">
      <div class="card">
        <h3>Total Orders</h3>
        <p id="userTotalOrders">0</p>
      </div>
      <div class="card">
        <h3>Delivered</h3>
        <p id="userDelivered">0</p>
      </div>
      <div class="card">
        <h3>Pending</h3>
        <p id="userPending">0</p>
      </div>
    </section>

    <!-- USER ORDER HISTORY -->
    <section class="orders-section">
      <h2>My Orders</h2>
      <p id="loadingText" style="color: gray;">Loading latest orders...</p>
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Item</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="userOrdersBody">
          <!-- Orders will load here -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>¬© 2025 Labwat‚Äôs Place. All rights reserved.</p>
  </footer>

  <!-- Supabase Library + Initialization -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Replace with your Supabase credentials
    const SUPABASE_URL = "https://kcweibojxcpdpgrgisjt.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtjd2VpYm9qeGNwZHBncmdpc2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NDk1NTksImV4cCI6MjA3NjUyNTU1OX0.5FZZLgfoWqwZ7CV5W-XSELi1kinifrC9Y_rzqDpn6AY";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>

  <!-- DASHBOARD SCRIPT -->
  <script>
    let user = null;

    async function checkUser() {
      const { data, error } = await supabase.auth.getUser();
      if (error || !data.user) {
        window.location.href = "login.html";
        return;
      }
      user = data.user;
      document.getElementById("userName").textContent = user.user_metadata.full_name || "Customer";
    }

    async function loadDashboard() {
      if (!user) return;

      document.getElementById("loadingText").style.display = "block";

      const { data: orders, error } = await supabase
        .from("orders")
        .select("*")
        .eq("user_id", user.id)
        .order("date", { ascending: false });

      document.getElementById("loadingText").style.display = "none";

      if (error) {
        console.error("Error fetching orders:", error);
        return;
      }

      // Update summary cards
      const totalOrders = orders.length;
      const delivered = orders.filter(o => o.status === "Delivered").length;
      const pending = orders.filter(o => o.status === "Pending").length;

      document.getElementById("userTotalOrders").textContent = totalOrders;
      document.getElementById("userDelivered").textContent = delivered;
      document.getElementById("userPending").textContent = pending;

      // Render orders table
      const tableBody = document.getElementById("userOrdersBody");
      tableBody.innerHTML = "";
      orders.forEach(order => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${order.item}</td>
          <td>‚Ç¶${order.amount}</td>
          <td><span class="status ${order.status.toLowerCase()}">${order.status}</span></td>
          <td>${new Date(order.date).toLocaleDateString()}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    // Initialize
    (async function init() {
      await checkUser();
      await loadDashboard();
      // ‚è± Auto-refresh every 10 seconds
      setInterval(loadDashboard, 10000);
    })();
  </script>
</body>
</html>

