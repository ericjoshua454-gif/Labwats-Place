<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Dashboard | Labwat‚Äôs Place</title>

  <!-- Responsive Stylesheets -->
  <link rel="stylesheet" href="desktop.css" media="screen and (min-width: 1025px)" />
  <link rel="stylesheet" href="tablet.css" media="screen and (min-width: 768px) and (max-width: 1024px)" />
  <link rel="stylesheet" href="mobile.css" media="screen and (max-width: 767px)" />
</head>
<body>
  <!-- HEADER -->
  <header class="main-header">
    <h2 class="logo">Labwat‚Äôs Place</h2>
    <nav class="navbar">
      <a href="index.html">Home</a>
      <a href="#" id="logoutBtn">Logout</a>
    </nav>
  </header>

  <!-- DASHBOARD MAIN -->
  <main class="user-dashboard container">
    <h1>Welcome, <span id="userName">Customer</span> üëã</h1>

    <!-- SUMMARY CARDS -->
    <section class="summary-cards">
      <div class="card">
        <h3>Total Orders</h3>
        <p id="userTotalOrders">0</p>
      </div>
      <div class="card">
        <h3>Delivered</h3>
        <p id="userDelivered">0</p>
      </div>
      <div class="card">
        <h3>Pending</h3>
        <p id="userPending">0</p>
      </div>
    </section>

    <!-- USER ORDER HISTORY -->
    <section class="orders-section">
      <h2>My Orders</h2>
      <table class="orders-table">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Item</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="userOrdersBody">
          <!-- Orders will load here -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>¬© 2025 Labwat‚Äôs Place. All rights reserved.</p>
  </footer>

  <!-- Supabase Library + Initialization -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Replace these with your Supabase credentials
    const SUPABASE_URL = "https://YOUR_PROJECT_URL.supabase.co";
    const SUPABASE_KEY = "YOUR_ANON_PUBLIC_KEY";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>

  <!-- DASHBOARD SCRIPT -->
  <script>
    async function loadDashboard() {
      // 1Ô∏è‚É£ Check if user is logged in
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) {
        window.location.href = "login.html";
        return;
      }

      // 2Ô∏è‚É£ Display user's name
      document.getElementById("userName").textContent =
        user.user_metadata.full_name || "Customer";

      // 3Ô∏è‚É£ Fetch orders for this user
      const { data: orders, error: orderError } = await supabase
        .from("orders")
        .select("*")
        .eq("user_id", user.id);

      if (orderError) {
        console.error("Error fetching orders:", orderError);
        return;
      }

      // 4Ô∏è‚É£ Update summary cards
      const totalOrders = orders.length;
      const delivered = orders.filter(o => o.status === "Delivered").length;
      const pending = orders.filter(o => o.status === "Pending").length;

      document.getElementById("userTotalOrders").textContent = totalOrders;
      document.getElementById("userDelivered").textContent = delivered;
      document.getElementById("userPending").textContent = pending;

      // 5Ô∏è‚É£ Display orders in table
      const tableBody = document.getElementById("userOrdersBody");
      tableBody.innerHTML = "";
      orders.forEach(order => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${order.item}</td>
          <td>‚Ç¶${order.amount}</td>
          <td><span class="status ${order.status.toLowerCase()}">${order.status}</span></td>
          <td>${new Date(order.date).toLocaleDateString()}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // 6Ô∏è‚É£ Logout functionality
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });

    // 7Ô∏è‚É£ Run the dashboard
    loadDashboard();
  </script>
</body>
</html>
